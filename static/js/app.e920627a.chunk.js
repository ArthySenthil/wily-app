(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{199:function(t,e,n){"use strict";n.d(e,"a",(function(){return L}));var a=n(2),r=n.n(a),s=n(4),o=n.n(s),c=n(5),i=n.n(c),l=n(7),u=n.n(l),d=n(1),f=n.n(d),p=n(0),h=n.n(p),m=n(14),b=n(58),y=n(43),k=n(355),g=n(11),I=n.n(g),S=n(34),x=n(12),v=n(86),B=n(36),w=n(192),T=n(68),E=n(356),C=n(198),P=n(65);n(154);P.initializeApp({apiKey:"AIzaSyDrhx5lpqT-Ix7Y2xJpnhYOvp0gXQFeHTo",authDomain:"wily-app-a4aac.firebaseapp.com",databaseURL:"https://wily-app-a4aac.firebaseio.com",projectId:"wily-app-a4aac",storageBucket:"wily-app-a4aac.appspot.com",messagingSenderId:"139697245457",appId:"1:139697245457:web:ba2bd31f64b31f055910b0"});var R=P.firestore();function D(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=f()(t);if(e){var r=f()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var A=function(t){i()(a,t);var e=D(a);function a(){var t;return r()(this,a),(t=e.call(this)).getCameraPermissions=function(e){var n,a;return I.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,I.a.awrap(E.b(E.a));case 2:n=r.sent,a=n.status,t.setState({hasCameraPermissions:"granted"===a,buttonState:e,scanned:!1});case 5:case"end":return r.stop()}}),null,null,null,Promise)},t.handleBarCodeScanned=function(e){var n,a;return I.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:e.type,n=e.data,"BookId"===(a=t.state.buttonState)?t.setState({scanned:!0,scannedBookId:n,buttonState:"normal"}):"StudentId"===a&&t.setState({scanned:!0,scannedStudentId:n,buttonState:"normal"});case 3:case"end":return r.stop()}}),null,null,null,Promise)},t.initiateBookIssue=function(){return I.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:R.collection("transactions").add({studentId:t.state.scannedStudentId,bookId:t.state.scannedBookId,date:P.firestore.Timestamp.now().toDate(),transactionType:"Issue"}),R.collection("books").doc(t.state.scannedBookId).update({bookAvailability:!1}),R.collection("students").doc(t.state.scannedStudentId).update({numberOfBooksIssued:P.firestore.FieldValue.increment(1)}),T.a.alert("Book issued!"),t.setState({scannedStudentId:"",scannedBookId:""});case 5:case"end":return e.stop()}}),null,null,null,Promise)},t.initiateBookReturn=function(){return I.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:R.collection("transactions").add({studentId:t.state.scannedStudentId,bookId:t.state.scannedBookId,date:P.firestore.Timestamp.now().toDate(),transactionType:"Return"}),R.collection("books").doc(t.state.scannedBookId).update({bookAvailability:!0}),R.collection("students").doc(t.state.scannedStudentId).update({numberOfBooksIssued:P.firestore.FieldValue.increment(-1)}),t.setState({scannedStudentId:"",scannedBookId:""});case 4:case"end":return e.stop()}}),null,null,null,Promise)},t.checkBookEligibility=function(){var e,n;return I.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,I.a.awrap(R.collection("books").where("bookId","==",t.state.scannedBookId).get());case 2:return e=a.sent,n="",0==e.docs.length?(n="false",console.log(e.docs.length)):e.docs.map((function(t){var e=t.data();n=e.bookAvailability?"Issue":"Return"})),a.abrupt("return",n);case 6:case"end":return a.stop()}}),null,null,null,Promise)},t.checkStudentEligibilityForBookIssue=function(){var e,n;return I.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,I.a.awrap(R.collection("students").where("studentId","==",t.state.scannedStudentId).get());case 2:return e=a.sent,n="",0==e.docs.length?(t.setState({scannedStudentId:"",scannedBookId:""}),n=!1,T.a.alert("The student id doesn't exist in the database!")):e.docs.map((function(e){e.data().numberOfBooksIssued<2?n=!0:(n=!1,T.a.alert("The student has already issued 2 books!"),t.setState({scannedStudentId:"",scannedBookId:""}))})),a.abrupt("return",n);case 6:case"end":return a.stop()}}),null,null,null,Promise)},t.checkStudentEligibilityForReturn=function(){var e,n;return I.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,I.a.awrap(R.collection("transactions").where("bookId","==",t.state.scannedBookId).limit(1).get());case 2:return e=a.sent,n="",e.docs.map((function(e){e.data().studentId===t.state.scannedStudentId?n=!0:(n=!1,T.a.alert("The book wasn't issued by this student!"),t.setState({scannedStudentId:"",scannedBookId:""}))})),a.abrupt("return",n);case 6:case"end":return a.stop()}}),null,null,null,Promise)},t.handleTransaction=function(){var e;return I.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,I.a.awrap(t.checkBookEligibility());case 2:if(e=n.sent,console.log("Transaction Type",e),e){n.next=9;break}T.a.alert("The book doesn't exist in the library database!"),t.setState({scannedStudentId:"",scannedBookId:""}),n.next=22;break;case 9:if("Issue"!==e){n.next=17;break}return n.next=12,I.a.awrap(t.checkStudentEligibilityForBookIssue());case 12:n.sent&&t.initiateBookIssue(),T.a.alert("Book issued to the student!"),n.next=22;break;case 17:return n.next=19,I.a.awrap(t.checkStudentEligibilityForReturn());case 19:n.sent&&t.initiateBookReturn(),T.a.alert("Book returned to the library!");case 22:case"end":return n.stop()}}),null,null,null,Promise)},t.state={hasCameraPermissions:null,scanned:!1,scannedBookId:"",scannedStudentId:"",buttonState:"normal",transactionMessage:""},t}return o()(a,[{key:"render",value:function(){var t=this,e=this.state.hasCameraPermissions,a=this.state.scanned,r=this.state.buttonState;return"normal"!==r&&e?h.a.createElement(C.a,{onBarCodeScanned:a?void 0:this.handleBarCodeScanned,style:m.a.absoluteFillObject}):"normal"===r?h.a.createElement(w.a,{behavior:"padding",style:V.container},h.a.createElement(x.a,null,h.a.createElement(b.a,{source:n(306),style:{width:200,height:200}}),h.a.createElement(S.a,{style:{textAlign:"center",fontSize:30}},"Wily")),h.a.createElement(x.a,{style:V.inputView},h.a.createElement(B.a,{style:V.inputBox,placeholder:"Book Id",onChangeText:function(e){t.setState({scannedBookId:e})},value:this.state.scannedBookId}),h.a.createElement(v.a,{style:V.scanButton,onPress:function(){t.getCameraPermissions("BookId")}},h.a.createElement(S.a,{style:V.buttonText},"Scan"))),h.a.createElement(x.a,{style:V.inputView},h.a.createElement(B.a,{style:V.inputBox,placeholder:"Student Id",onChangeText:function(e){t.setState({scannedStudentId:e})},value:this.state.scannedStudentId}),h.a.createElement(v.a,{style:V.scanButton,onPress:function(){t.getCameraPermissions("StudentId")}},h.a.createElement(S.a,{style:V.buttonText},"Scan"))),h.a.createElement(S.a,{style:V.transactionAlert},this.state.transactionMessage),h.a.createElement(v.a,{style:V.submitButton,onPress:function(){var e;return I.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:e=t.handleTransaction(),console.log("Transaction Message: ",e);case 2:case"end":return n.stop()}}),null,null,null,Promise)}},h.a.createElement(S.a,{style:V.submitButtonText},"Submit"))):void 0}}]),a}(h.a.Component),V=m.a.create({container:{flex:1,justifyContent:"center",alignItems:"center"},displayText:{fontSize:15,textDecorationLine:"underline"},scanButton:{backgroundColor:"#2196F3",padding:10,margin:10},buttonText:{fontSize:15,textAlign:"center",marginTop:10},inputView:{flexDirection:"row",margin:20},inputBox:{width:200,height:40,borderWidth:1.5,borderRightWidth:0,fontSize:20},scanButton:{backgroundColor:"#66BB6A",width:50,borderWidth:1.5,borderLeftWidth:0},submitButton:{backgroundColor:"#FBC02D",width:100,height:50},submitButtonText:{padding:10,textAlign:"center",fontSize:20,fontWeight:"bold",color:"white"},transactionAlert:{margin:10,color:"red"}}),F=n(29),W=n.n(F),j=n(64);n(145);function O(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=f()(t);if(e){var r=f()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var z=function(t){i()(n,t);var e=O(n);function n(t){var a;return r()(this,n),(a=e.call(this,t)).fetchMoreTransactions=function(){var t,e;return I.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=a.state.search.toUpperCase(),"B"!==(e=t.split(""))[0].toUpperCase()){n.next=9;break}return n.next=5,I.a.awrap(R.collection("transactions").where("bookId","==",t).startAfter(a.state.lastVisibleTransaction).limit(10).get());case 5:n.sent.docs.map((function(t){a.setState({allTransactions:[].concat(W()(a.state.allTransactions),[t.data()]),lastVisibleTransaction:t})})),n.next=14;break;case 9:if("S"!==e[0].toUpperCase()){n.next=14;break}return n.next=12,I.a.awrap(R.collection("transactions").where("bookId","==",t).startAfter(a.state.lastVisibleTransaction).limit(10).get());case 12:n.sent.docs.map((function(t){a.setState({allTransactions:[].concat(W()(a.state.allTransactions),[t.data()]),lastVisibleTransaction:t})}));case 14:case"end":return n.stop()}}),null,null,null,Promise)},a.searchTransactions=function(t){var e;return I.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if("B"!==(e=t.split(""))[0].toUpperCase()){n.next=8;break}return n.next=4,I.a.awrap(R.collection("transactions").where("bookId","==",t).get());case 4:n.sent.docs.map((function(t){a.setState({allTransactions:[].concat(W()(a.state.allTransactions),[t.data()]),lastVisibleTransaction:t})})),n.next=13;break;case 8:if("S"!==e[0].toUpperCase()){n.next=13;break}return n.next=11,I.a.awrap(R.collection("transactions").where("studentId","==",t).get());case 11:n.sent.docs.map((function(t){a.setState({allTransactions:[].concat(W()(a.state.allTransactions),[t.data()]),lastVisibleTransaction:t})}));case 13:case"end":return n.stop()}}),null,null,null,Promise)},a.componentDidMount=function(){return I.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I.a.awrap(R.collection("transactions").limit(10).get());case 2:t.sent.docs.map((function(t){a.setState({allTransactions:[],lastVisibleTransaction:t})}));case 4:case"end":return t.stop()}}),null,null,null,Promise)},a.state={allTransactions:[],lastVisibleTransaction:null,search:""},a}return o()(n,[{key:"render",value:function(){var t=this;return h.a.createElement(x.a,{style:M.container},h.a.createElement(x.a,{style:M.searchBar},h.a.createElement(B.a,{style:M.bar,placeholder:"Enter Book Id or Student Id",onChangeText:function(e){t.setState({search:e})}}),h.a.createElement(v.a,{style:M.searchButton,onPress:function(){t.searchTransactions(t.state.search)}},h.a.createElement(S.a,null,"Search"))),h.a.createElement(j.a,{data:this.state.allTransactions,renderItem:function(t){var e=t.item;return h.a.createElement(x.a,{style:{borderBottomWidth:2}},h.a.createElement(S.a,null,"Book Id: "+e.bookId),h.a.createElement(S.a,null,"Student id: "+e.studentId),h.a.createElement(S.a,null,"Transaction Type: "+e.transactionType),h.a.createElement(S.a,null,"Date: "+e.date.toDate()))},keyExtractor:function(t,e){return e.toString()},onEndReached:this.fetchMoreTransactions,onEndReachedThreshold:.7}))}}]),n}(h.a.Component),M=m.a.create({container:{flex:1,marginTop:20},searchBar:{flexDirection:"row",height:40,width:"auto",borderWidth:.5,alignItems:"center",backgroundColor:"grey"},bar:{borderWidth:2,height:30,width:300,paddingLeft:10},searchButton:{borderWidth:1,height:30,width:50,alignItems:"center",justifyContent:"center",backgroundColor:"green"}});function U(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=f()(t);if(e){var r=f()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var L=function(t){i()(n,t);var e=U(n);function n(){return r()(this,n),e.apply(this,arguments)}return o()(n,[{key:"render",value:function(){return h.a.createElement(N,null)}}]),n}(h.a.Component),J=Object(k.a)({Transaction:{screen:A},Search:{screen:z}},{defaultNavigationOptions:function(t){var e=t.navigation;return{tabBarIcon:function(){var t=e.state.routeName;return console.log(t),"Transaction"===t?h.a.createElement(b.a,{source:n(343),style:{width:40,height:40}}):"Search"===t?h.a.createElement(b.a,{source:n(344),style:{width:40,height:40}}):void 0}}}}),N=Object(y.createAppContainer)(J);m.a.create({container:{flex:1,backgroundColor:"red",alignItems:"center",justifyContent:"center"}})},200:function(t,e,n){t.exports=n(345)},306:function(t,e,n){t.exports=n.p+"static/media/booklogo.7982cd70.jpg"},343:function(t,e,n){t.exports=n.p+"static/media/book.ef7b8d1f.png"},344:function(t,e,n){t.exports=n.p+"static/media/searchingbook.4e7a9d52.png"}},[[200,1,2]]]);
//# sourceMappingURL=app.e920627a.chunk.js.map